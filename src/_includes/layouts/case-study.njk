{% extends "layouts/base.njk" %}

{% set bodyClass = "case-study" %}

{# =========================
   Styles
========================= #}
{% block styles %}
  <link rel="stylesheet" href="/assets/css/case-studies.css">
  <link rel="stylesheet" href="/assets/css/patterns/block.css">
  <link rel="stylesheet" href="/assets/css/patterns/sidebar.css">
  <link rel="stylesheet" href="/assets/css/patterns/hero.css">
{% endblock %}

{# =========================
   Generate Table of Contents
========================= #}
{% set headings = [] %}
{% set headingRegex = '<h2[^>]*id="([^"]+)"[^>]*>(.*?)</h2>' %}

{% for match in content | regexFindAll(headingRegex) %}
  {% set _ = headings.push({
    id: match[1],
    text: match[2] | striptags
  }) %}
{% endfor %}

{# =========================
   Content
========================= #}
{% block content %}

{# Hero Section (variant can be overridden in front matter) #}

<div class="grid-container">
{% include "patterns/hero/hero.njk" %}
  {# Sidebar / TOC (optional) #}
  {% if showSidebar | default(true) %}
    <aside class="sidebar">
      {% if headings | length > 0 %}
      <nav class="toc">
        <h2>On this page</h2>
        <ul>
          {% for heading in headings %}
            <li><a href="#{{ heading.id }}">{{ heading.text }}</a></li>
          {% endfor %}
        </ul>
      </nav>
      {% endif %}
    </aside>
  {% endif %}

  {# Main Article #}
  <article class="main-content">
    {{ content | safe }}

    {# Footer CTA #}
    <footer class="outro">
      {% if showOutro | default(true) %}
        <button class="btn-primary center">Thank you for reading!</button>
        <p>Want to discuss this project or collaborate? <a href="/contact/">Get in touch!</a></p>
      {% endif %}
    </footer>
  </article>

</div>

{% endblock %}

